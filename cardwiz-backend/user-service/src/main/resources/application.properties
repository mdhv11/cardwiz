spring.application.name=user-service
spring.config.import=optional:file:./.env[.properties],optional:file:./user-service/.env[.properties]

# DB config - FIXED: Changed epoch_mysql to mysqldb to match infra docker-compose
spring.datasource.url=jdbc:postgresql://localhost:5432/cardwiz
spring.datasource.username=${DB_USERNAME:cardwiz_user}
spring.datasource.password=${DB_PASSWORD:cardwiz_pass}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.open-in-view=false
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=update

# Server Port Configuration
server.port=${SERVER_PORT:8080}

# Eureka Client - FIXED: Added variable for consistency
eureka.client.service-url.defaultZone=${EUREKA_SERVER:http://localhost:8761/eureka/}
eureka.instance.prefer-ip-address=true

# Redis cache
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=${REDIS_TIMEOUT:2s}
spring.cache.type=redis
spring.cache.redis.cache-null-values=false
spring.cache.redis.use-key-prefix=true

# JWT related properties - FIXED: Changed to JWT_SECRET to match other services
application.security.jwt.secret-key=${JWT_SECRET:Fk1Al6wj+mpRhqQHXHjRWPzezx4ddNz3XF2IX5VHsUo=}
# expiration time=24 hrs (in milliseconds)
application.security.jwt.expiration=${JWT_EXPIRATION:86400000}

# AWS S3 Configuration
aws.s3.enabled=true
aws.s3.region=us-east-1
aws.s3.document-bucket-name=${AWS_S3_DOCUMENT_BUCKET_NAME:${AWS_S3_BUCKET_NAME:cardwiz-docs}}
aws.s3.access-key=${AWS_S3_ACCESS_KEY:minioadmin}
aws.s3.secret-key=${AWS_S3_SECRET_KEY:minioadmin123}
aws.s3.endpoint=${AWS_S3_ENDPOINT:http://localhost:9000}
  #s3.us-east-1.amazonaws.com

# Spring Cloud Gateway (MVC) routes
# Route health explicitly so /api/v1/ai/health resolves to ai-service /health
spring.cloud.gateway.mvc.routes[0].id=ai-service-health
spring.cloud.gateway.mvc.routes[0].uri=${AI_SERVICE_URL:lb://ai-service}
spring.cloud.gateway.mvc.routes[0].predicates[0]=Path=/api/v1/ai/health
spring.cloud.gateway.mvc.routes[0].filters[0]=SetPath=/health

# Route all other AI endpoints, e.g. /api/v1/ai/documents/analyze -> /ai/v1/documents/analyze
spring.cloud.gateway.mvc.routes[1].id=ai-service
spring.cloud.gateway.mvc.routes[1].uri=${AI_SERVICE_URL:lb://ai-service}
spring.cloud.gateway.mvc.routes[1].predicates[0]=Path=/api/v1/ai/**
spring.cloud.gateway.mvc.routes[1].filters[0]=RewritePath=/api/v1/ai/(?<segment>.*), /ai/v1/$\{segment}

# Multipart file upload configuration
spring.servlet.multipart.max-file-size=${MAX_FILE_SIZE:5MB}
spring.servlet.multipart.max-request-size=${MAX_REQUEST_SIZE:5MB}

# Kafka async document ingestion
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer
app.kafka.topic.document-ingest=${KAFKA_DOCUMENT_INGEST_TOPIC:cardwiz.document.ingest}

# Internal callback guard for AI -> user-service status updates
app.internal.ai-callback-secret=${AI_CALLBACK_SECRET:cardwiz-internal-secret}
